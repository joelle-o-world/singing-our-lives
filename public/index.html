<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="UTF-8">
    <title>Singing Our Lives</title>
    <link rel="stylesheet" type="text/css" href="main.css" />

    <!-- include socket libs: -->
    <script src="/socket.io/socket.io.js"></script>

    <script type="text/javascript" src="sol.bundle.js"></script>
  </head>


  <script>
    const socket = io();
    console.log("## Socket: ", socket)

    window.onload = function() {
      showPage(0);

      let recorderIO = new RecorderInterface();
      recorderIO.onupload = files => {
        socket.emit('audioupload', files.map(blob => ({
          buffer: blob,
          type: blob.type
        })));
      }
      document.getElementById("recorder_wrapper")
        .appendChild(recorderIO.makeHTML());
    }

    function showPage(pageIndexOrID) {
      // Hide all other pages.
      const pages = document.getElementById("pages").children;
      for(let page of pages)
        page.hidden = true;


      if(typeof pageIndexOrID == "string")
        // Open a page using its 'id' attribute.
        document.getElementById(pageIndexOrID).hidden = false;

      else if(typeof pageIndexOrID == "number") {
        // Open a page using a numeric id.
        pages[pageIndexOrID].hidden = false;
      }
    }

    function thankYouForm(e) {
      // prevent page refresh
      e.preventDefault();
      
      const form = document.getElementById('thank_you_form');

      const feedback = {
        email: form.elements.namedItem("email").value,
        comment: form.elements.namedItem("comment").value
      }

      socket.emit('formFill', feedback)

      form.hidden = true;
      document.getElementById("thanks_again").hidden = false;
    }
  </script>

  <body>
    <span id="pages">

      <div id="welcome_page">
        <!-- PAGE 1 -->
        <h1>Welcome.</h1>
        <button
          class="nextbtn"
          onclick = "showPage('recording_page')"
        >Take Part.</button>
      </div>

      <div id="recording_page">
        <!-- PAGE 2 -->
        <span id="recorder_wrapper"></span>

        <button class=nextbtn onclick="showPage('thank_you_page')">Continue</button>
      </div>

      <div id="thank_you_page">
        <!-- PAGE 3 -->
        <h1>Thank you.</h1>
        <p>Thank you for contributing to Singing Our Lives! Please provide your email address below if you are okay with us getting in contact with you.  Please also add anything else that you didn't get a chance to say earlier, and press 'Submit' when you are finished.</p>

        <form id="thank_you_form">
          <input name="email" placeholder="email (optional" />
          <br>
          <textarea name="comment" placeholder="Anything else to add?"></textarea>
          <br>
          <button onclick="thankYouForm(event)">Submit</button>
        </form>
        <div id=thanks_again hidden>Thanks for your feedback!</div>
      </div>

    </span>
  </body>

</html>
