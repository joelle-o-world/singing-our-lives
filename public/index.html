<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8">
  <title>Singing Your Life</title>
  <link rel="stylesheet" type="text/css" href="main.css" />

  <!-- include socket libs: -->
  <script src="/socket.io/socket.io.js"></script>
  <!-- include p5 libs: -->
  <!--<script src="libraries/p5.js"></script>
  <script src="libraries/p5.dom.js"></script>
  <script defer src="libraries/p5.sound.js"></script>
  <script src="sketch.js"></script>
-->

  <script>
      if (!window.MediaRecorder) {
        document.write(
          decodeURI('%3Cscript defer src="/polyfill.bundle.js">%3C/script>')
        )
      }
    </script>

  <script defer type="text/javascript" src="sol.bundle.js"></script>
</head>


<script>
const socket = io();
console.log("## Socket: ", socket)

let mediauploads
window.onload = function() {
  showPage(0);

  mediauploads = new SingingOurLives.MediaUploads();

  let recorderIO = new SingingOurLives.RecorderInterface();
  //pass blobs created by RecorderInterface to MediaUploads
  recorderIO.onrecord = b => {
    mediauploads.newFile(b);
  }

  document.getElementById("recorder_wrapper")
  .appendChild(recorderIO.makeHTML());

  document.getElementById("recorder_wrapper")
  .appendChild(mediauploads.makeHTML());
}



function showPage(pageIndexOrID) {
  // Hide all other pages.
  const pages = document.getElementById("pages").children;
  for(let page of pages)
  page.hidden = true;


  if(typeof pageIndexOrID == "string")
  // Open a page using its 'id' attribute.
  document.getElementById(pageIndexOrID).hidden = false;

  else if(typeof pageIndexOrID == "number") {
    // Open a page using a numeric id.
    pages[pageIndexOrID].hidden = false;
  }
}

function finishedRecording() {
  // Gather up files.
  let blobs = mediauploads.blobs;

  console.log('uploading:', blobs)
  socket.emit('upload', blobs.map(blob => ({
    buffer: blob,
    type: blob.type
  })));

  // Finally turn to the thank you page.
  showPage('thank_you_page');
}

function thankYouForm(e) {
  // prevent page refresh
  e.preventDefault();

  const form = document.getElementById('thank_you_form');
  const lyrics = document.getElementById('lyrics_textarea');

  const feedback = {
    email: form.elements.namedItem("email").value,
    lyrics: lyrics.value,
    comment: form.elements.namedItem("comment").value,
    consent: form.elements.namedItem("consent").value
  }

  socket.emit('formFill', feedback)

  form.hidden = true;
  document.getElementById("thanks_again").hidden = false;
}
</script>

<body>
  <span id="pages">
    <div id="welcome_page">
      <div class="header">
        <img class="sol_logo" src="assets/imgs/sol_logo.png">
        <div class="row">
          <div class="column">
            <img src="assets/imgs/banner1.png">
          </div>
        </div>
      </div>
      <div id="welcome_text_wrapper">
        <div id="welcome_titles">
          <h2>Welcome to the Singing Our Lives Songwriting Project:</h2>
          <h1>Singing Your Life</h1>
        </div>
        <div id="welcome_body">
          <p>On this site you will be able to become part of a massive songwriting project!</p>
          <p>Now in its third year, <a href="http://togetherproductions.co.uk/singing-our-lives.html">Singing Our Lives</a> is a ground-breaking project bringing refugees, migrants and the wider communities across the UK together with professional musicians to compose new music and perform together.</p>
          <p>Conceived and developed by <a href="http://togetherproductions.co.uk/">Together Productions</a>, the project has attracted partners including the Royal Opera House, Guildhall School of Music and Drama and the International Organization for Migration, amongst many others. The project celebrates diversity and solidarity through choral music and has pioneered a unique collaborative dialogue and composition process that results in powerful new works reflecting the culture and experiences of hundreds of people from diverse backgrounds across the UK.</p>
          <strong>We are now expanding the project to enable anyone to be included!</strong>
          <p><strong>HOW?:</strong> On the following page, you can record your own music (up to 5 mins), or upload lyrics or an image that is your response to the prompt on that page.</p>
          <p><strong>WHY?:</strong> So far the Singing Our Lives choirs have collectively written <a href="https://soundcloud.com/user-253631663/sets/singing-our-lives-1">four wonderful songs</a> and we would love to include your ideas for the next phase of the project. Once they are written we will invite you to hear them performed live in concert and you will be part of a global creative team that aims to bring together people who otherwise would never meet, to celebrate our similarities as well as our differences.</p>
          <p><strong>BUT I CAN’T SING!</strong> We welcome everyone’s contributions, no matter whether you’re a complete beginner or experienced creative; we believe everyone has a voice!</p>
          <p><strong>WHAT WILL YOU DO WITH MY CONTRIBUTION?:</strong> Our brilliant creative team of composer <a href="http://www.stilltimemusic.co.uk/">Mike Roberts</a> and librettist <a href="https://en.wikipedia.org/wiki/Tess_Berry-Hart">Tess Berry-Hart</a> will add your contributions to the mix and will curate it into three brand new songs!</p>
        </div>
      </div>
      <div id="welcome_video_div">
        <video id= "welcome_video" src="assets/ellie.mp4" controls/>
      </div>
      <button
      class="nextbtn"
      onclick = "showPage('recording_page')"
      >Take Part.</button>
      <div id="welcome_footer">
        <div class="logo_set_wrap" id="produced">
          <div class="logo_wrap">
            <img src="assets/imgs/TogetherLogoVertical.png">
          </div>
          <div class="logo_wrap">
            <img id="gsmd" src="assets/imgs/gsmd_logo.png">
          </div>
          <div class="logo_wrap">
            <img src="assets/imgs/community_fund.png">
          </div>
          <div class="logo_wrap">
            <img src="assets/imgs/lottery_logo.jpg">
          </div>
        </div>
      </div>
    </div>

    <div id="recording_page">
      <!-- PAGE 2 -->
      <div class="header">
        <img class="sol_logo" src="assets/imgs/sol_logo.png">
        <div class="row">
          <div class="column">
            <img src="assets/imgs/banner1.png">
          </div>
        </div>
      </div>
      <div id="p5canvas">
      </div>
      <span id="recorder_wrapper">
      </span>
      <div id="lyrics_form">
        <h1>Submit lyrics:</h1>
        <div class="provocation_text">
          <p>Our themes for songs this year are Nature, Future, Unity and Love. We'd love to hear what you think! Share your thoughts with us - write an original poem, a haiku or a fragment of writing - or just jot down your ideas in diary or prose form. Even one line can help us weave together something beautiful!</p>
        </div>
        <textarea name="lyrics" id="lyrics_textarea"></textarea>
      </div>

      <button class=nextbtn onclick="finishedRecording()">Send & Continue</button>
      <br>
      <button class=nextbtn onclick="showPage('welcome_page')">Back</button>
    </div>

    <div id="thank_you_page">
      <div class="header">
        <img class="sol_logo" src="assets/imgs/sol_logo.png">
        <div class="row">
          <div class="column">
            <img src="assets/imgs/banner2.png">
          </div>
        </div>
      </div>
      <div id="thank_you_page_text_wrapper">
        <div id="thank_you_titles">
          <h2>Thank you so much for being part of the Singing Our Lives Songwriting Project:</h2>
          <h1>Singing Your Life.</h1>
        </div>
        <div id="thank_you_body">
          <p>Your creative contributions are now in the big pool of music, words and art that our team are going to turn into new songs.</p>
          <p>We would love to stay in touch with you so we can let you know what’s happening with the project and invite you to hear them when they are complete.</p>
          <p>Please complete your details here to join our mailing list.</p>
        </div>
        <div id="form_wrap">
          <form id="thank_you_form">
            <input name="email" placeholder="email (optional)" />
            <br>
            <textarea name="comment" placeholder="Anything else to add?"></textarea>
            <br>
            <p>Please tick the following box to indicate that you allow Together Productions to use the contributions you have provided:</p>
            <input type="checkbox" name="consent"/>
            <br>
            <button class=nextbtn onclick="thankYouForm(event)">Submit</button>
          </form>
          <button class=nextbtn onclick="showPage('recording_page')">Back</button>
          <div id=thanks_again hidden>Thank you for your contributions!</div>
        </div>
      </div>
    </div>
  </span>
</body>

</html>
